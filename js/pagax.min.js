var pagax_modules={};pagax_modules.ajax=pagax_modules.ajax||{default_request:{url:window.location.href,data:{location:window.location.href},before_message:"",error_message:"",error:function(){},success_message:"",success:function(){},failed:function(){}},last_request:this.default_request,request_count:0,active_request:"",running_requests:[],running_request_parameters:{},build:function(a){var b={url:a.url,type:a.hasOwnProperty("type")?a.type:"POST",data:a.hasOwnProperty("data")?a.data:{},before_message:a.hasOwnProperty("before_message")?a.before_message:"",success_message:a.hasOwnProperty("success_message")?a.success_message:"",error_message:a.hasOwnProperty("error_message")?a.error_message:"",contentType:a.hasOwnProperty("contentType")?a.contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!a.hasOwnProperty("processData")||a.processData,beforeSend:function(b,c,d){a.hasOwnProperty("beforeSend")&&"function"==typeof a.beforeSend&&a.beforeSend(b,c,d)},error:function(b,c,d){a.hasOwnProperty("error")&&"function"==typeof a.error&&a.error(b,c,d)},success:function(b,c,d){a.hasOwnProperty("success")&&"function"==typeof a.success&&a.success(b,c,d)},complete:function(b,c,d){a.hasOwnProperty("complete")&&"function"==typeof a.complete&&a.complete(b,c,d)},failed:function(b,c,d){a.hasOwnProperty("failed")&&"function"==typeof a.failed&&a.failed(b,c,d)}};return b.hasOwnProperty("callback_parameters")||(b.callback_parameters={}),b.data.view_only=b.data.hasOwnProperty("view_only")?b.data.view_only:"true",b.data.requesting_url=b.data.hasOwnProperty("requesting_url")?b.data.requesting_url:window.location.href,b},new_request:function(feed){var obj=this;feed=obj.build(feed);var request=$.ajax({url:feed.url,data:feed.data,type:feed.type,timeout:6e4,contentType:feed.contentType,processData:feed.processData,beforeSend:function(a){obj.running_requests.push(feed.url),obj.running_request_parameters[feed.url]=feed,""==obj.active_request&&(obj.active_request=feed.url),feed.before_message&&($(".pagax-loader-layer .message-box").removeClass("success error"),$(".pagax-loader-layer .message").html(obj.running_request_parameters.hasOwnProperty(obj.active_request)?obj.running_request_parameters[obj.active_request].before_message:feed.before_message),$(".pagax-loader-layer").show()),obj.last_request=feed,feed.beforeSend(a)},success:function(response,status,xhr){try{response=$.parseJSON(response)}catch(a){feed.callback_parameters.is_json=!1}feed.callback_parameters.response=response,response.hasOwnProperty("data")||(feed.callback_parameters.data={title:""}),null!=response&&"success"==response.status&&(response.hasOwnProperty("data")&&(response.data.hasOwnProperty("redirect")||response.data.hasOwnProperty("refresh"))?pagax_modules.pagax.process_content(feed,response,feed.success):feed.success(feed.callback_parameters.response,status,xhr),obj.refresh_content(response),response.hasOwnProperty("data")&&response.data.hasOwnProperty("onload")&&eval(response.data.onload)),null!=response&&(!response.hasOwnProperty("status")||response.hasOwnProperty("status")&&"success"==response.status)?((feed.hasOwnProperty("redirect")&&!feed.redirect||!feed.hasOwnProperty("redirect"))&&obj.running_requests.length<=1&&$(".pagax-loader-layer").hide(),response.hasOwnProperty("message")||feed.success_message?($(".pagax-loader-layer .message-box").removeClass("error").addClass("success"),$(".pagax-loader-layer .message").html(response.hasOwnProperty("message")?response.message:feed.success_message),$(".pagax-loader-layer").show(),1==obj.running_requests.length?setTimeout(function(){$(".pagax-loader-layer").fadeOut(function(){$(".pagax-loader-layer").hide()})},2e3):($(".pagax-loader-layer .message-box").removeClass("success error"),$(".pagax-loader-layer .message").html(obj.running_request_parameters[obj.active_request].before_message),$(".pagax-loader-layer").show())):obj.running_requests.length<=1&&$(".pagax-loader-layer").hide()):null!=response&&response.hasOwnProperty("status")&&"failed"==response.status?(response.hasOwnProperty("message")||error_message?$(".pagax-loader-layer .message").html(response.hasOwnProperty("message")?response.message:error_message):$(".pagax-loader-layer .message").html("Some error occurred"),feed.failed(response,status,xhr)):null==response?($(".pagax-loader-layer .message-box").removeClass("success").addClass("error"),$(".pagax-loader-layer .message").html(error_message),$(".pagax-loader-layer").show()):0==obj.running_requests.length&&$(".pagax-loader-layer").hide(),obj.last_request=obj.default_request},complete:function(a,b,c){var d=0,e=[];$.each(obj.running_requests,function(a,b){b!=feed.url&&(e[d]=b,d++)}),obj.running_requests=e,delete obj.running_request_parameters[feed.url],obj.running_requests.length?(obj.active_request=e[0],$(".pagax-loader-layer .message-box").removeClass("success error"),$(".pagax-loader-layer .message").html(obj.running_request_parameters[obj.active_request].before_message)):obj.active_request="",obj.form_is_in_progress=!1,$("#pagax_request_try_again").click(function(){obj.new_request(obj.last_request)}),feed.complete(a,b,c)},error:function(a,b,c){if("error"==b&&("Internal Server Error"==c?$(".pagax-loader-layer .message").html('Internal Server Error!&nbsp;<a class="link" href="javascript:void(0);" id="pagax_request_try_again" style="float:none; margin-top:0;">Try Again</a>'):$(".pagax-loader-layer .message").html('Error!&nbsp;No internet connection.&nbsp;<a class="link" href="javascript:void(0);" id="pagax_request_try_again" style="float:none; margin-top:0;">Try Again</a>')),"timeout"==b&&($(".pagax-loader-layer .message").html('Error!&nbsp;Connection Timed out.<a class="link" id="pagax_request_try_again" style="float:none; margin-top:0;">Try Again</a>'),obj.request_count<3)){var d=5;$(".pagax-loader-layer .message").html("Error!&nbsp;Connection Timed out.&nbsp;Trying Again in "+d+" sec.");var e=setInterval(function(){d--,$(".pagax-loader-layer .message").html("Error!&nbsp;Connection Timed out.&nbsp;Trying Again in "+d+" sec."),d||clearInterval(e)},1e3);setTimeout(function(){obj.request_count++,obj.new_request(feed,"")},5500)}feed.error(a,b,c)}})},submit_form:function(a){var b=this;if(window.ActiveXObject||"ActiveXObject"in window)return!0;var c=a.hasOwnProperty("success")?a.success:"",d=a.hasOwnProperty("failed")?a.failed:"",e={success:function(a){if(""!=a){if(a.hasOwnProperty("data")&&a.data.hasOwnProperty("redirect"))return pagax_modules.pagax.handle_redirect(a),!1;"function"==typeof c&&c(a)}},failed:function(a){return"function"==typeof d&&d(a),!1}};return a=$.extend({},a,e),b.new_request(a),!1},refresh_content:function(a){a.hasOwnProperty("data")&&a.data.hasOwnProperty("refresh")&&$.each(a.data.refresh,function(a,b){var c={};$.ajax_request({url:HOST+a,before_message:"Loading",data:c,success:function(a){$("#"+b).html(a.data.content),$("#"+b).loaded()}})})},parseQueryString:function(a){var b={};if(a){var c,d,e,f;for(a=a.split("?"),c=a[1].split("&"),e=0,f=c.length;e<f;e++)d=c[e].split("="),b[d[0]]=d[1]}return b},set_callback_parameters:function(a,b,c){return callback_parameters=b.hasOwnProperty("callback_parameters")?b.callback_parameters:{},callback_parameters.title=a.data.hasOwnProperty("title")?a.data.title:history.state.title,callback_parameters.data=a.data,c&&(callback_parameters.form_parameters=!0),callback_parameters},call_callback:function(a,b,c,d){var e=this;if(""!=a){if("function"==typeof a)f=a;else var f=window[a];if("undefined"!==f&&$.isFunction(f)){var g=e.set_callback_parameters(b,c,d);f(g)}}}},$.ajax_request=function(a,b){pagax_modules.ajax.new_request(a,b)},pagax_modules.forms=pagax_modules.forms||{get_values:function(a){var b=["input:text:not([disabled])","input[type='number']:not([disabled])","input:hidden:not([disabled])","input:password:not([disabled])","input:checkbox:checked:not([disabled])","input:radio:checked:not([disabled])","select:not([disabled])","textarea:not([disabled])"];container=$("#"+a);for(var c={},d=0;d<b.length;d++){var e=container.find(b[d]);$(e).each(function(){var a=$(this).attr("name")?$(this).attr("name"):$(this).attr("id");a?a=a:jQuery.error="Undefined attr name for "+b[d],void 0!=a&&(a.match(/\[\]/g)?(a=a.replace("[]",""),$.isArray(c[a])||(c[a]=[]),c[a].push($(this).val())):c[a]=$(this).val())})}return c},empty_fields:function(a){var b=["input:text","input:hidden","input:password","input:checked","select","textarea"];container=$("#"+a);for(var c=0;c<b.length;c++)for(var d=container.find(b[c]),e=0;e<d.length;++e)d[e].value=""}},$.fn.onSubmit=function(a){a.url=a.hasOwnProperty("url")?a.url:$(this).attr("action"),a.before_message=a.hasOwnProperty("before_message")?a.before_message:"Loading..";var b=pagax_modules.ajax.build(a);b.id=$(this).attr("id"),pagax_modules.ajax.form_is_in_progress=!1,$(this).off("submit").on("submit",function(c){if(c.preventDefault(),a.hasOwnProperty("validate")&&!$(this).hasClass("isValid"))return!1;if(!pagax_modules.ajax.form_is_in_progress){pagax_modules.ajax.form_is_in_progress=!0,b.data=$.extend({},b.data,pagax_modules.forms.get_values(b.id));var d=pagax_modules.ajax.parseQueryString(location.search);"undefined"!=d&&(b.data=$.extend({},b.data,d)),pagax_modules.ajax.submit_form(b)}})},pagax_modules.pagax=pagax_modules.pagax||{key_pressed:!1,user_agent:navigator.userAgent,load_content:function(a,b){var c=this,d={request:"page",page_location:a.link,requesting_url:window.location.href};a.hasOwnProperty("url")&&(d.view_only="true");var e={url:a.hasOwnProperty("url")?a.url:"/ajax.php",data:d,before_message:a.hasOwnProperty("before_message")?a.before_message:"Loading..",beforeSend:function(b){a.hasOwnProperty("beforeSend")&&"function"==typeof a.beforeSend&&a.beforeSend(b)},error:"",success:function(d,e,f){c.process_content(a,d,b)}};a.hasOwnProperty("post_parameters")&&(e.data=$.extend({},e.data,a.post_parameters),a.post_parameters.hasOwnProperty("data")&&a.post_parameters.data.hasOwnProperty("targetType")&&"modal"==a.post_parameters.data.targetType&&(e.targetType="modal",$("#"+a.post_parameters.data.target).length||pagax_modules.settings.modal.create(a.post_parameters.data.target),pagax_modules.settings.modal.activate(a.post_parameters.data.target),$("#"+a.post_parameters.data.target).parents(pagax_modules.settings.modal.container).off("click").on("click",function(b){$("#"+a.post_parameters.data.target).is(b.target)||0!==$("#"+a.post_parameters.data.target).has(b.target).length||(window.history.state.hasOwnProperty("next")&&window.history.state.next.anchor.hasOwnProperty("data")&&window.history.state.next.anchor.data.hasOwnProperty("target")&&window.history.state.next.anchor.target==a.post_parameters.data.target?pagax_modules.settings.modal.hide(a.post_parameters.data.target):window.history.back())}))),a.hasOwnProperty("redirect")&&(e=$.extend({},e,{redirect:a.redirect})),$.ajax_request(e)},process_content:function(a,b,c){var d=this;if(""==b.data)window.location=a.link;else{if(b.hasOwnProperty("data")&&b.data.hasOwnProperty("redirect"))return d.handle_redirect(b),!1;b.hasOwnProperty("data")&&(a.response=b.data,d.set_page_content(a))}pagax_modules.ajax.call_callback(c,b,a)},handle_redirect:function(a){if(obj=this,a.data.hasOwnProperty("redirect")){var b={};return previous=history.state,b.id=previous.id+1,b.url=a.data.redirect,b.title=a.data.title,b.anchor={target:"content_container"},obj.load_content({before_message:"Redirecting..",redirect:!0,url:a.data.redirect,link:a.data.redirect,callback_parameters:{page:b,previous:previous,data:a.data,title:a.data.title},anchor:b.anchor,post_parameters:{force_ajax:!0}},pagax_modules.pagax.navigation_callback),!1}},set_page_content:function(a){$("#"+a.anchor.target).html(a.response.content),"content_container"==a.anchor.target?$("html, body").animate({scrollTop:0},1):$("html, body").animate({scrollTop:$("#"+a.anchor.target).offset().top-$("#topbar").outerHeight()-20},1),$("#page_scripts").html(a.response.page_scripts),a.anchor.hasOwnProperty("data")&&a.anchor.data.hasOwnProperty("targetType")&&pagax_modules.settings.modal.show(a.anchor.target),a.response.hasOwnProperty("remove")&&$.each(a.response.remove,function(a,b){$("#"+a).remove()}),setTimeout(function(){$(document).trigger("page_ready"),$(document).trigger("page_load")},50)},onpopstate:function(a){var b=this;return a.state.hasOwnProperty("next")&&a.state.next.anchor.hasOwnProperty("data")&&a.state.next.anchor.data.hasOwnProperty("targetType")&&"modal"==a.state.next.anchor.data.targetType&&$("#"+a.state.next.anchor.target).length?(pagax_modules.settings.modal.hide(a.state.next.anchor.data.target),setTimeout(function(){pagax_modules.settings.modal.remove(a.state.next.anchor.data.target)},100),!1):void(a.state&&(state_parameters={url:a.state.url,link:a.state.url,anchor:a.state.anchor},a.state.anchor.hasOwnProperty("data")&&(state_parameters.post_parameters={data:a.state.anchor.data}),b.load_content(state_parameters,function(b){window.history.replaceState(a.state,b.title,a.state.url),document.title=b.title})))},navigation_callback:function(a){a.page.title=a.title,a.previous.next=a.page,a.data.hasOwnProperty("replace_url")&&(a.previous.url=a.data.replace_url),window.history.replaceState(a.previous,a.previous.title,a.previous.url),a.page.anchor.hasOwnProperty("data")&&a.page.anchor.data.hasOwnProperty("sameState")&&1==a.page.anchor.data.sameState||window.history.pushState(a.page,a.page.title,a.page.url),document.title=a.title},onready:function(a){var b=this;if(!(window.ActiveXObject||"ActiveXObject"in window)){var c=window.location.href,d={id:null!=window.history.state&&window.history.state.hasOwnProperty("id")?window.history.state.id:0,url:c,title:document.title,anchor:null!=window.history.state&&window.history.state.hasOwnProperty("anchor")?window.history.state.anchor:{target:"content_container"}};if(null!=window.history.state&&window.history.state.hasOwnProperty("anchor")&&window.history.state.anchor.hasOwnProperty("data")&&window.history.state.anchor.data.hasOwnProperty("targetType")&&"modal"==window.history.state.anchor.data.targetType&&!$("#"+window.history.state.anchor.target).length&&(d.anchor={target:"content_container"}),history.state&&(history.state.hasOwnProperty("next")&&(d.next=history.state.next),history.state.hasOwnProperty("form_parameters")&&(d.form_parameters=history.state.form_parameters)),!$(".pagax-loader-layer").length){var e='<div class="pagax-loader-layer"><div class="message-box"><div class="message">Loading...</div><a class="cancel-loader">Cancel</a></div></div>';$("body").append(e),$(".pagax-loader-layer .cancel-loader").off("click").on("click",function(){$(".pagax-loader-layer").hide()})}window.history.replaceState(d,document.title,c)}$("a[data-pagax_link='true'], div[href]").unbind("click").click(function(){var a=$(this),c=a.attr("href");if(!(b.user_agent.match(/Macintosh/g)&&(91==b.key_pressed||93==b.key_pressed)||null==b.user_agent.match(/Macintosh/g)&&17==b.key_pressed)&&(a.data("pagax_link")||a.is("div"))){if(a.data("target",a.data("target")?a.data("target"):"content_container"),c&&a.data("target")&&c!=window.location.href){var d={};if(previous=history.state,d.id=previous.id+1,d.url=c,d.title=document.title,d.anchor={target:a.data("target"),id:a.attr("id")},!(window.ActiveXObject||"ActiveXObject"in window)){var e={link:c,anchor:d.anchor,callback_parameters:{page:d,previous:previous}};e.post_parameters={data:{}},e.anchor.data={},$.each($(this).data(),function(a,b){$.isPlainObject(b)||(e.post_parameters.data[a]=b,e.anchor.data[a]=b)}),e.url=c,b.load_content(e,pagax_modules.pagax.navigation_callback)}}if(!(window.ActiveXObject||"ActiveXObject"in window))return!1}})},onkeydown:function(a){obj=this,a=a?a:document.event,obj.key_pressed=a.which?a.which:a.keyCode},onkeyup:function(a){obj=this,obj.key_pressed=!1}},$.fn.pagax=function(){$(this).find("a[href]").each(function(){var a=HOST;"/"===a.substr(-1)&&(a=a.substr(0,a.length-1)),null!=$(this).attr("href").match(new RegExp(a,"g"))&&$(this).attr("data-pagax_link","true")}),$.each(pagax_modules,function(a,b){$.isFunction(b.onready)&&b.onready()}),$(document).off("keydown").on("keydown",function(a){$.each(pagax_modules,function(b,c){$.isFunction(c.onkeydown)&&c.onkeydown(a)})}),$(document).off("keyup").on("keyup",function(a){$.each(pagax_modules,function(b,c){$.isFunction(c.onkeyup)&&c.onkeyup(a)})})},$.initPagax=function(a){pagax_modules.settings=a,window.onpopstate=function(a){$.each(pagax_modules,function(b,c){$.isFunction(c.onpopstate)&&c.onpopstate(a)})},$(document).ready(function(){$(document).trigger("page_ready")})},$(document).on("page_ready",function(){$("body").loaded()}),$.fn.load_complete=function(a){},$.fn.loaded=function(a){$(this).pagax(),$(this).load_complete(),$("[data-ajax_form='true']").each(function(){var a=$(this);$(this).onSubmit({url:a.attr("action")})})};