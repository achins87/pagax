var pagax_modules={};pagax_modules.ajax=pagax_modules.ajax||{default_request:{url:window.location.href,data:{location:window.location.href},before_message:"",error_message:"",error:function(){},success_message:"",success:function(){},failed:function(){}},last_request:this.default_request,request_count:0,active_request:"",running_requests:[],running_request_parameters:{},build:function(e){var a={url:e.url,type:e.hasOwnProperty("type")?e.type:"POST",data:e.hasOwnProperty("data")?e.data:{},before_message:e.hasOwnProperty("before_message")?e.before_message:"",success_message:e.hasOwnProperty("success_message")?e.success_message:"",error_message:e.hasOwnProperty("error_message")?e.error_message:"",contentType:e.hasOwnProperty("contentType")?e.contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:e.hasOwnProperty("processData")?e.processData:"",beforeSend:function(a,t,r){e.hasOwnProperty("beforeSend")&&"function"==typeof e.beforeSend&&e.beforeSend(a,t,r)},error:function(a,t,r){e.hasOwnProperty("error")&&"function"==typeof e.error&&e.error(a,t,r)},success:function(a,t,r){e.hasOwnProperty("success")&&"function"==typeof e.success&&e.success(a,t,r)},complete:function(a,t,r){e.hasOwnProperty("complete")&&"function"==typeof e.complete&&e.complete(a,t,r)},failed:function(a,t,r){e.hasOwnProperty("failed")&&"function"==typeof e.failed&&e.failed(a,t,r)}};return a.hasOwnProperty("callback_parameters")||(a.callback_parameters={}),a.data.view_only=a.data.hasOwnProperty("view_only")?a.data.view_only:"true",a.data.requesting_url=a.data.hasOwnProperty("requesting_url")?a.data.requesting_url:window.location.href,a},new_request:function(feed){var obj=this;feed=obj.build(feed);var request=$.ajax({url:feed.url,data:feed.data,type:feed.type,timeout:6e4,contentType:feed.contentType,beforeSend:function(e){obj.running_requests.push(feed.url),obj.running_request_parameters[feed.url]=feed,""==obj.active_request&&(obj.active_request=feed.url),feed.before_message&&($(".pagax-loader-layer .message-box").removeClass("success error"),$(".pagax-loader-layer .message").html(obj.running_request_parameters.hasOwnProperty(obj.active_request)?obj.running_request_parameters[obj.active_request].before_message:feed.before_message),$(".pagax-loader-layer").show()),obj.last_request=feed,feed.beforeSend(e)},success:function(response,status,xhr){try{response=$.parseJSON(response)}catch(err){feed.callback_parameters.is_json=!1}response.hasOwnProperty("data")?feed.callback_parameters.response=response:feed.callback_parameters.data={title:""},null!=response&&"success"==response.status&&(response.hasOwnProperty("data")&&(response.data.hasOwnProperty("redirect")||response.data.hasOwnProperty("refresh"))?pagax_modules.pagax.process_content(feed,response,feed.success):feed.success(feed.callback_parameters.response,status,xhr),obj.refresh_content(response),response.hasOwnProperty("data")&&response.data.hasOwnProperty("onload")&&eval(response.data.onload)),null!=response&&(!response.hasOwnProperty("status")||response.hasOwnProperty("status")&&"success"==response.status)?((feed.hasOwnProperty("redirect")&&!feed.redirect||!feed.hasOwnProperty("redirect"))&&obj.running_requests.length<=1&&$(".pagax-loader-layer").hide(),response.hasOwnProperty("message")||feed.success_message?($(".pagax-loader-layer .message-box").removeClass("error").addClass("success"),$(".pagax-loader-layer .message").html(response.hasOwnProperty("message")?response.message:feed.success_message),$(".pagax-loader-layer").show(),1==obj.running_requests.length?setTimeout(function(){$(".pagax-loader-layer").fadeOut(function(){$(".pagax-loader-layer").hide()})},2e3):($(".pagax-loader-layer .message-box").removeClass("success error"),$(".pagax-loader-layer .message").html(obj.running_request_parameters[obj.active_request].before_message),$(".pagax-loader-layer").show())):obj.running_requests.length<=1&&$(".pagax-loader-layer").hide()):null!=response&&response.hasOwnProperty("status")&&"failed"==response.status?(response.hasOwnProperty("message")||error_message?$(".pagax-loader-layer .message").html(response.hasOwnProperty("message")?response.message:error_message):$(".pagax-loader-layer .message").html("Some error occurred"),feed.failed(response,status,xhr)):null==response?($(".pagax-loader-layer .message-box").removeClass("success").addClass("error"),$(".pagax-loader-layer .message").html(error_message),$(".pagax-loader-layer").show()):0==obj.running_requests.length&&$(".pagax-loader-layer").hide(),obj.last_request=obj.default_request},complete:function(e,a,t){var r=0,s=[];$.each(obj.running_requests,function(e,a){a!=feed.url&&(s[r]=a,r++)}),obj.running_requests=s,delete obj.running_request_parameters[feed.url],obj.running_requests.length?(obj.active_request=s[0],$(".pagax-loader-layer .message-box").removeClass("success error"),$(".pagax-loader-layer .message").html(obj.running_request_parameters[obj.active_request].before_message)):obj.active_request="",obj.form_is_in_progress=!1,$("#pagax_request_try_again").click(function(){obj.new_request(obj.last_request)}),feed.complete(e,a,t)},error:function(e,a,t){if("error"==a&&("Internal Server Error"==t?$(".pagax-loader-layer .message").html('Internal Server Error!&nbsp;<a class="link" href="javascript:void(0);" id="pagax_request_try_again" style="float:none; margin-top:0;">Try Again</a>'):$(".pagax-loader-layer .message").html('Error!&nbsp;No internet connection.&nbsp;<a class="link" href="javascript:void(0);" id="pagax_request_try_again" style="float:none; margin-top:0;">Try Again</a>')),"timeout"==a&&($(".pagax-loader-layer .message").html('Error!&nbsp;Connection Timed out.<a class="link" id="pagax_request_try_again" style="float:none; margin-top:0;">Try Again</a>'),obj.request_count<3)){var r=5;$(".pagax-loader-layer .message").html("Error!&nbsp;Connection Timed out.&nbsp;Trying Again in "+r+" sec.");var s=setInterval(function(){r--,$(".pagax-loader-layer .message").html("Error!&nbsp;Connection Timed out.&nbsp;Trying Again in "+r+" sec."),r||clearInterval(s)},1e3);setTimeout(function(){obj.request_count++,obj.new_request(feed,"")},5500)}feed.error(e,a,t)}})},submit_form:function(e){var a=this;if(window.ActiveXObject||"ActiveXObject"in window)return!0;var t=e.hasOwnProperty("success")?e.success:"",r=e.hasOwnProperty("failed")?e.failed:"";return e.success=function(e){if(""!=e){if(e.hasOwnProperty("data")&&e.data.hasOwnProperty("redirect"))return pagax_modules.pagax.handle_redirect(e),!1;"function"==typeof t&&t(e)}},e.failed=function(e){return"function"==typeof r&&r(e),!1},a.new_request(e),!1},refresh_content:function(e){e.hasOwnProperty("data")&&e.data.hasOwnProperty("refresh")&&$.each(e.data.refresh,function(e,a){var t={};$.ajax_request({url:HOST+e,before_message:"Loading",data:t,success:function(e){$("#"+a).html(e.data.content),$("#"+a).loaded()}})})},parseQueryString:function(e){if(e){var a,t,r,s,o={};for(e=e.split("?"),a=e[1].split("&"),r=0,s=a.length;s>r;r++)t=a[r].split("="),o[t[0]]=t[1];return o}},set_callback_parameters:function(e,a,t){return callback_parameters=a.hasOwnProperty("callback_parameters")?a.callback_parameters:{},callback_parameters.title=e.data.hasOwnProperty("title")?e.data.title:history.state.title,callback_parameters.data=e.data,t&&(callback_parameters.form_parameters=!0),callback_parameters},call_callback:function(e,a,t,r){var s=this;if(""!=e){if("function"==typeof e)o=e;else var o=window[e];if("undefined"!==o&&$.isFunction(o)){var n=s.set_callback_parameters(a,t,r);o(n)}}}},$.ajax_request=function(e,a){pagax_modules.ajax.new_request(e,a)},pagax_modules.forms=pagax_modules.forms||{get_values:function(e){var a=["input:text:not([disabled])","input[type='number']:not([disabled])","input:hidden:not([disabled])","input:password:not([disabled])","input:checkbox:checked:not([disabled])","input:radio:checked:not([disabled])","select:not([disabled])","textarea:not([disabled])"];container=$("#"+e);for(var t={},r=0;r<a.length;r++){var s=container.find(a[r]);$(s).each(function(){var e=$(this).attr("name")?$(this).attr("name"):$(this).attr("id");e?e=e:jQuery.error="Undefined attr name for "+a[r],void 0!=e&&(e.match(/\[\]/g)?(e=e.replace("[]",""),$.isArray(t[e])||(t[e]=[]),t[e].push($(this).val())):t[e]=$(this).val())})}return t},empty_fields:function(e){var a=["input:text","input:hidden","input:password","input:checked","select","textarea"];container=$("#"+e);for(var t=0;t<a.length;t++)for(var r=container.find(a[t]),s=0;s<r.length;++s)r[s].value=""}},$.fn.onSubmit=function(e){e.url=e.hasOwnProperty("url")?e.url:$(this).attr("action");var a=pagax_modules.ajax.build(e);a.id=$(this).attr("id"),pagax_modules.ajax.form_is_in_progress=!1,$(this).off("submit").on("submit",function(t){if(t.preventDefault(),e.hasOwnProperty("validate")&&!$(this).hasClass("isValid"))return!1;if(!pagax_modules.ajax.form_is_in_progress){pagax_modules.ajax.form_is_in_progress=!0,a.data=$.extend({},a.data,pagax_modules.forms.get_values(a.id));var r=pagax_modules.ajax.parseQueryString(location.search);"undefined"!=r&&(a.data=$.extend({},a.data,r)),pagax_modules.ajax.submit_form(a)}})},pagax_modules.pagax=pagax_modules.pagax||{key_pressed:!1,user_agent:navigator.userAgent,load_content:function(e,a){var t=this,r={request:"page",page_location:e.link,requesting_url:window.location.href};e.hasOwnProperty("url")&&(r.view_only="true");var s={url:e.hasOwnProperty("url")?e.url:"/ajax.php",data:r,before_message:e.hasOwnProperty("before_message")?e.before_message:"Loading..",beforeSend:function(a){e.hasOwnProperty("beforeSend")&&"function"==typeof e.beforeSend&&e.beforeSend(a)},error:"",success:function(r,s,o){t.process_content(e,r,a)}};e.hasOwnProperty("post_parameters")&&(s.data=$.extend({},s.data,e.post_parameters),e.post_parameters.hasOwnProperty("data")&&e.post_parameters.data.hasOwnProperty("targetType")&&"modal"==e.post_parameters.data.targetType&&(s.targetType="modal",$("#"+e.post_parameters.data.target).length||pagax_modules.settings.modal.create(e.post_parameters.data.target),pagax_modules.settings.modal.activate(e.post_parameters.data.target),$("#"+e.post_parameters.data.target).parents(pagax_modules.settings.modal.container).off("click").on("click",function(a){$("#"+e.post_parameters.data.target).is(a.target)||0!==$("#"+e.post_parameters.data.target).has(a.target).length||(window.history.state.hasOwnProperty("next")&&window.history.state.next.anchor.hasOwnProperty("data")&&window.history.state.next.anchor.data.hasOwnProperty("target")&&window.history.state.next.anchor.target==e.post_parameters.data.target?pagax_modules.settings.modal.hide(e.post_parameters.data.target):window.history.back())}))),e.hasOwnProperty("redirect")&&(s=$.extend({},s,{redirect:e.redirect})),$.ajax_request(s)},process_content:function(e,a,t){var r=this;if(""==a.data)window.location=e.link;else{if(a.hasOwnProperty("data")&&a.data.hasOwnProperty("redirect"))return r.handle_redirect(a),!1;a.hasOwnProperty("data")&&(e.response=a.data,r.set_page_content(e))}pagax_modules.ajax.call_callback(t,a,e)},handle_redirect:function(e){if(obj=this,e.data.hasOwnProperty("redirect")){var a={};return previous=history.state,a.id=previous.id+1,a.url=e.data.redirect,a.title=e.data.title,a.anchor={target:"content_container"},obj.load_content({before_message:"Redirecting..",redirect:!0,url:e.data.redirect,link:e.data.redirect,callback_parameters:{page:a,previous:previous,data:e.data,title:e.data.title},anchor:a.anchor,post_parameters:{force_ajax:!0}},pagax_modules.pagax.navigation_callback),!1}},set_page_content:function(e){$("#"+e.anchor.target).html(e.response.content),"content_container"==e.anchor.target?$("html, body").animate({scrollTop:0},1):$("html, body").animate({scrollTop:$("#"+e.anchor.target).offset().top-$("#topbar").outerHeight()-20},1),$("#page_scripts").html(e.response.page_scripts),e.anchor.hasOwnProperty("data")&&e.anchor.data.hasOwnProperty("targetType")&&pagax_modules.settings.modal.show(e.anchor.target),e.response.hasOwnProperty("remove")&&$.each(e.response.remove,function(e,a){$("#"+e).remove()}),setTimeout(function(){$(document).trigger("page_ready"),$(document).trigger("page_load")},50)},onpopstate:function(e){var a=this;return e.state.hasOwnProperty("next")&&e.state.next.anchor.hasOwnProperty("data")&&e.state.next.anchor.data.hasOwnProperty("targetType")&&"modal"==e.state.next.anchor.data.targetType&&$("#"+e.state.next.anchor.target).length?(pagax_modules.settings.modal.hide(e.state.next.anchor.data.target),setTimeout(function(){pagax_modules.settings.modal.remove(e.state.next.anchor.data.target)},100),!1):void(e.state&&(state_parameters={url:e.state.url,link:e.state.url,anchor:e.state.anchor},e.state.anchor.hasOwnProperty("data")&&(state_parameters.post_parameters={data:e.state.anchor.data}),a.load_content(state_parameters,function(a){window.history.replaceState(e.state,a.title,e.state.url),document.title=a.title})))},navigation_callback:function(e){e.page.title=e.title,e.previous.next=e.page,e.data.hasOwnProperty("replace_url")&&(e.previous.url=e.data.replace_url),window.history.replaceState(e.previous,e.previous.title,e.previous.url),e.page.anchor.hasOwnProperty("data")&&e.page.anchor.data.hasOwnProperty("sameState")&&1==e.page.anchor.data.sameState||window.history.pushState(e.page,e.page.title,e.page.url),document.title=e.title},onready:function(e){var a=this;if(!(window.ActiveXObject||"ActiveXObject"in window)){var t=window.location.href,r={id:null!=window.history.state&&window.history.state.hasOwnProperty("id")?window.history.state.id:0,url:t,title:document.title,anchor:null!=window.history.state&&window.history.state.hasOwnProperty("anchor")?window.history.state.anchor:{target:"content_container"}};if(null!=window.history.state&&window.history.state.hasOwnProperty("anchor")&&window.history.state.anchor.hasOwnProperty("data")&&window.history.state.anchor.data.hasOwnProperty("targetType")&&"modal"==window.history.state.anchor.data.targetType&&!$("#"+window.history.state.anchor.target).length&&(r.anchor={target:"content_container"}),history.state&&(history.state.hasOwnProperty("next")&&(r.next=history.state.next),history.state.hasOwnProperty("form_parameters")&&(r.form_parameters=history.state.form_parameters)),!$(".pagax-loader-layer").length){var s='<div class="pagax-loader-layer"><div class="message-box"><div class="message">Loading...</div><a class="cancel-loader">Cancel</a></div></div>';$("body").append(s),$(".pagax-loader-layer .cancel-loader").off("click").on("click",function(){$(".pagax-loader-layer").hide()})}window.history.replaceState(r,document.title,t)}$("a[data-pagax_link='true'], div[href]").unbind("click").click(function(){var e=$(this),t=e.attr("href");if(!(a.user_agent.match(/Macintosh/g)&&(91==a.key_pressed||93==a.key_pressed)||null==a.user_agent.match(/Macintosh/g)&&17==a.key_pressed)&&(e.data("pagax_link")||e.is("div"))){if(e.data("target",e.data("target")?e.data("target"):"content_container"),t&&e.data("target")&&t!=window.location.href){var r={};if(previous=history.state,r.id=previous.id+1,r.url=t,r.title=document.title,r.anchor={target:e.data("target"),id:e.attr("id")},!(window.ActiveXObject||"ActiveXObject"in window)){var s={link:t,anchor:r.anchor,callback_parameters:{page:r,previous:previous}};s.post_parameters={data:{}},s.anchor.data={},$.each($(this).data(),function(e,a){$.isPlainObject(a)||(s.post_parameters.data[e]=a,s.anchor.data[e]=a)}),s.url=t,a.load_content(s,pagax_modules.pagax.navigation_callback)}}if(!(window.ActiveXObject||"ActiveXObject"in window))return!1}})},onkeydown:function(e){obj=this,e=e?e:document.event,obj.key_pressed=e.which?e.which:e.keyCode},onkeyup:function(e){obj=this,obj.key_pressed=!1}},$.fn.pagax=function(){$(this).find("a[href]").each(function(){var e=HOST;"/"===e.substr(-1)&&(e=e.substr(0,e.length-1)),null!=$(this).attr("href").match(new RegExp(e,"g"))&&$(this).attr("data-pagax_link","true")}),$.each(pagax_modules,function(e,a){$.isFunction(a.onready)&&a.onready()}),$(document).off("keydown").on("keydown",function(e){$.each(pagax_modules,function(a,t){$.isFunction(t.onkeydown)&&t.onkeydown(e)})}),$(document).off("onkeyup").on("onkeyup",function(e){$.each(pagax_modules,function(a,t){$.isFunction(t.onkeyup)&&t.onkeyup(e)})})},window.onpopstate=function(e){$.each(pagax_modules,function(a,t){$.isFunction(t.onpopstate)&&t.onpopstate(e)})},$(document).ready(function(){$(document).trigger("page_ready")}),$(document).on("page_ready",function(){$("body").loaded()}),$.fn.loaded=function(e){$(this).pagax()};